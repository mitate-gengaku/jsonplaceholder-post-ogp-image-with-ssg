import { cn } from "@/lib/utils";
import { ImageResponse } from "next/og";
 
export const config = {
  runtime: 'edge',
};

function splitStringIntoChunks(str: string, chunkSize = 7) {
  const chunks = [];
  for (let i = 0; i < str.length; i += chunkSize) {
    chunks.push(str.slice(i, i + chunkSize));
  }
  return chunks;
}

export default async function handler() {
  const fontUrl = new URL("../../../../public/ShipporiMincho-Bold.ttf", import.meta.url)
  const fontData = await (await fetch(fontUrl)).arrayBuffer()

  const title = "我これより航空戦の指揮を";
  const author = "宮沢賢治";

  const titles = splitStringIntoChunks(title).map((v) => v.split(""))

  return new ImageResponse(
    (
      <div
        tw="w-full h-full flex justify-center bg-white relative py-12 px-16"
        >
        <div
          tw="w-[369px] h-[534px] mx-auto my-0 p-10 flex flex-row-reverse bg-slate-200 text-[32px] leading-[1.1] rounded-xl"
          style={{  
            fontFamily: "ShipporiMincho"
          }}
          >
          {titles.map((title, i) => (
            <div
              tw="flex flex-col justify-start text-[64px] leading-[1] font-bold"
              key={i}
              >
              {[...(new Array(7))].map((_, index) => (
                <span
                  tw={cn(
                    !title[index] && "text-transparent"
                  )}
                  key={index}
                  >
                  {title[index] ? title[index] : "あ"}
                </span>
              ))}
            </div>
          ))}
          <p
            tw="mt-6 mr-auto flex flex-col font-bold text-gray-500"
            >
            {author.split("").map((char, i) => (
              <span
                key={i}
                >
                {char}
              </span>
            ))}
          </p>
        </div>
        <svg 
          width="140" 
          height="32" 
          viewBox="0 0 140 32" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          style={{  
            position: "absolute",
            bottom: 48,
            right: 64
          }}
          >
          <path 
            d="M43.528 24.336C42.776 24.336 42.048 24.272 41.344 24.144C40.656 24.032 40.08 23.904 39.616 23.76C39.152 23.616 38.896 23.512 38.848 23.448L38.104 18.84L38.896 18.696C39.216 20.072 39.704 21.168 40.36 21.984C41.016 22.8 41.992 23.208 43.288 23.208C44.344 23.208 45.208 22.952 45.88 22.44C46.552 21.912 46.888 21.192 46.888 20.28C46.888 19.64 46.704 19.08 46.336 18.6C45.968 18.104 45.488 17.656 44.896 17.256C44.32 16.856 43.696 16.464 43.024 16.08C42.368 15.68 41.744 15.256 41.152 14.808C40.576 14.344 40.104 13.816 39.736 13.224C39.368 12.632 39.184 11.928 39.184 11.112C39.184 10.12 39.44 9.304 39.952 8.664C40.464 8.008 41.152 7.52 42.016 7.2C42.88 6.864 43.832 6.696 44.872 6.696C45.608 6.696 46.272 6.76 46.864 6.888C47.456 7 47.904 7.088 48.208 7.152L48.736 11.04L47.944 11.136C47.816 10.128 47.496 9.32 46.984 8.712C46.472 8.104 45.712 7.8 44.704 7.8C44.096 7.8 43.528 7.92 43 8.16C42.488 8.4 42.072 8.728 41.752 9.144C41.448 9.56 41.296 10.032 41.296 10.56C41.296 11.184 41.48 11.728 41.848 12.192C42.232 12.656 42.72 13.08 43.312 13.464C43.904 13.832 44.528 14.208 45.184 14.592C45.84 14.976 46.464 15.408 47.056 15.888C47.648 16.368 48.128 16.936 48.496 17.592C48.88 18.248 49.072 19.04 49.072 19.968C49.072 20.912 48.824 21.712 48.328 22.368C47.832 23.008 47.168 23.496 46.336 23.832C45.504 24.168 44.568 24.336 43.528 24.336ZM50.9611 24V23.28C51.1691 23.28 51.4571 23.256 51.8251 23.208C52.1931 23.16 52.5371 23.056 52.8571 22.896V7.104C52.6491 7.024 52.4011 6.984 52.1131 6.984C51.8411 6.968 51.5931 6.976 51.3691 7.008L51.1531 6.384L54.3211 5.064L54.8011 5.4V14.784C55.1691 14.512 55.5771 14.232 56.0251 13.944C56.4891 13.64 56.9691 13.384 57.4651 13.176C57.9611 12.968 58.4411 12.864 58.9051 12.864C59.1931 12.864 59.5211 12.912 59.8891 13.008C60.2731 13.104 60.6491 13.32 61.0171 13.656C61.3051 13.912 61.5371 14.264 61.7131 14.712C61.9051 15.16 62.0011 15.744 62.0011 16.464V22.896C62.3211 23.056 62.6651 23.16 63.0331 23.208C63.4011 23.256 63.6891 23.28 63.8971 23.28V24H58.1611V23.28C58.3691 23.28 58.6571 23.256 59.0251 23.208C59.3931 23.16 59.7371 23.056 60.0571 22.896V17.064C60.0571 16.664 60.0411 16.32 60.0091 16.032C59.9771 15.744 59.8811 15.472 59.7211 15.216C59.5451 14.928 59.3051 14.712 59.0011 14.568C58.7131 14.424 58.3851 14.352 58.0171 14.352C57.3451 14.352 56.7291 14.528 56.1691 14.88C55.6251 15.216 55.1691 15.528 54.8011 15.816V22.896C55.1211 23.056 55.4651 23.16 55.8331 23.208C56.2011 23.256 56.4891 23.28 56.6971 23.28V24H50.9611ZM70.3371 24.192C69.3131 24.192 68.3771 23.944 67.5291 23.448C66.6971 22.936 66.0251 22.256 65.5131 21.408C65.0171 20.56 64.7691 19.616 64.7691 18.576C64.7691 17.536 65.0091 16.584 65.4891 15.72C65.9851 14.856 66.6491 14.168 67.4811 13.656C68.3131 13.128 69.2411 12.864 70.2651 12.864C71.3211 12.864 72.2731 13.128 73.1211 13.656C73.9691 14.168 74.6331 14.848 75.1131 15.696C75.6091 16.544 75.8571 17.464 75.8571 18.456C75.8571 19.496 75.6091 20.456 75.1131 21.336C74.6331 22.2 73.9771 22.896 73.1451 23.424C72.3131 23.936 71.3771 24.192 70.3371 24.192ZM70.7211 23.136C71.3611 23.136 71.8971 22.944 72.3291 22.56C72.7771 22.176 73.1211 21.68 73.3611 21.072C73.6011 20.448 73.7211 19.792 73.7211 19.104C73.7211 18.24 73.5531 17.416 73.2171 16.632C72.8811 15.832 72.4251 15.176 71.8491 14.664C71.2891 14.152 70.6411 13.896 69.9051 13.896C69.2971 13.896 68.7611 14.088 68.2971 14.472C67.8491 14.84 67.4971 15.328 67.2411 15.936C67.0011 16.544 66.8811 17.2 66.8811 17.904C66.8811 18.752 67.0491 19.584 67.3851 20.4C67.7211 21.2 68.1771 21.856 68.7531 22.368C69.3291 22.88 69.9851 23.136 70.7211 23.136ZM77.0459 24V23.28C77.2539 23.28 77.5419 23.256 77.9099 23.208C78.2779 23.16 78.6219 23.056 78.9419 22.896V14.76C78.7339 14.68 78.4859 14.64 78.1979 14.64C77.9259 14.624 77.6779 14.632 77.4539 14.664L77.2379 14.04L80.4059 12.72L80.8859 13.056V14.544C81.4139 14.176 82.0139 13.808 82.6859 13.44C83.3739 13.056 84.0379 12.864 84.6779 12.864C84.9659 12.864 85.2939 12.912 85.6619 13.008C86.0459 13.104 86.4219 13.32 86.7899 13.656C86.9339 13.784 87.0699 13.944 87.1979 14.136C87.3259 14.312 87.4299 14.512 87.5099 14.736C87.8619 14.48 88.2619 14.208 88.7099 13.92C89.1739 13.632 89.6459 13.384 90.1259 13.176C90.6219 12.968 91.1019 12.864 91.5659 12.864C91.8539 12.864 92.1819 12.912 92.5499 13.008C92.9339 13.104 93.3099 13.32 93.6779 13.656C93.9659 13.912 94.1979 14.264 94.3739 14.712C94.5659 15.16 94.6619 15.744 94.6619 16.464V22.896C94.9819 23.056 95.3259 23.16 95.6939 23.208C96.0619 23.256 96.3499 23.28 96.5579 23.28V24H91.0139V23.28C91.1899 23.28 91.4459 23.256 91.7819 23.208C92.1179 23.16 92.4299 23.056 92.7179 22.896V17.064C92.7179 16.664 92.7019 16.32 92.6699 16.032C92.6379 15.744 92.5419 15.472 92.3819 15.216C92.2059 14.928 91.9659 14.712 91.6619 14.568C91.3739 14.424 91.0459 14.352 90.6779 14.352C90.0859 14.352 89.5339 14.496 89.0219 14.784C88.5259 15.056 88.0939 15.336 87.7259 15.624C87.7419 15.736 87.7499 15.864 87.7499 16.008C87.7659 16.152 87.7739 16.304 87.7739 16.464V22.896C88.0619 23.056 88.3739 23.16 88.7099 23.208C89.0459 23.256 89.3019 23.28 89.4779 23.28V24H84.1259V23.28C84.3019 23.28 84.5579 23.256 84.8939 23.208C85.2299 23.16 85.5419 23.056 85.8299 22.896V17.064C85.8299 16.664 85.8139 16.32 85.7819 16.032C85.7499 15.744 85.6539 15.472 85.4939 15.216C85.3179 14.928 85.0779 14.712 84.7739 14.568C84.4859 14.424 84.1579 14.352 83.7899 14.352C83.1979 14.352 82.6539 14.488 82.1579 14.76C81.6779 15.032 81.2539 15.304 80.8859 15.576V22.896C81.1739 23.056 81.4859 23.16 81.8219 23.208C82.1579 23.256 82.4139 23.28 82.5899 23.28V24H77.0459ZM103.009 24.192C101.985 24.192 101.049 23.944 100.201 23.448C99.369 22.936 98.697 22.256 98.185 21.408C97.689 20.56 97.441 19.616 97.441 18.576C97.441 17.536 97.681 16.584 98.161 15.72C98.657 14.856 99.321 14.168 100.153 13.656C100.985 13.128 101.913 12.864 102.937 12.864C103.993 12.864 104.945 13.128 105.793 13.656C106.641 14.168 107.305 14.848 107.785 15.696C108.281 16.544 108.529 17.464 108.529 18.456C108.529 19.496 108.281 20.456 107.785 21.336C107.305 22.2 106.649 22.896 105.817 23.424C104.985 23.936 104.049 24.192 103.009 24.192ZM103.393 23.136C104.033 23.136 104.569 22.944 105.001 22.56C105.449 22.176 105.793 21.68 106.033 21.072C106.273 20.448 106.393 19.792 106.393 19.104C106.393 18.24 106.225 17.416 105.889 16.632C105.553 15.832 105.097 15.176 104.521 14.664C103.961 14.152 103.313 13.896 102.577 13.896C101.969 13.896 101.433 14.088 100.969 14.472C100.521 14.84 100.169 15.328 99.913 15.936C99.673 16.544 99.553 17.2 99.553 17.904C99.553 18.752 99.721 19.584 100.057 20.4C100.393 21.2 100.849 21.856 101.425 22.368C102.001 22.88 102.657 23.136 103.393 23.136ZM113.03 24.192C112.678 24.192 112.334 24.112 111.998 23.952C111.662 23.792 111.406 23.576 111.23 23.304C111.086 23.08 110.982 22.8 110.918 22.464C110.87 22.128 110.846 21.664 110.846 21.072V14.4H109.574V13.656C109.894 13.464 110.222 13.216 110.558 12.912C110.894 12.608 111.214 12.28 111.518 11.928C111.822 11.576 112.086 11.264 112.31 10.992L112.79 11.208V13.056H116.126V14.4H112.79V20.952C112.79 21.448 112.814 21.824 112.862 22.08C112.926 22.32 113.07 22.512 113.294 22.656C113.502 22.784 113.774 22.84 114.11 22.824C114.462 22.808 114.798 22.76 115.118 22.68C115.454 22.584 115.694 22.496 115.838 22.416L116.174 23.016C115.774 23.336 115.318 23.616 114.806 23.856C114.31 24.08 113.718 24.192 113.03 24.192ZM120.916 24.192C120.372 24.192 119.796 24.128 119.188 24C118.58 23.888 118.124 23.744 117.82 23.568L117.316 20.448L118.108 20.304C118.252 21.088 118.54 21.76 118.972 22.32C119.42 22.864 120.012 23.136 120.748 23.136C121.308 23.136 121.78 23 122.164 22.728C122.548 22.456 122.74 22.056 122.74 21.528C122.74 21.144 122.58 20.8 122.26 20.496C121.94 20.176 121.548 19.872 121.084 19.584C120.62 19.28 120.148 18.96 119.668 18.624C119.204 18.288 118.812 17.912 118.492 17.496C118.172 17.064 118.012 16.552 118.012 15.96C118.012 14.984 118.364 14.224 119.068 13.68C119.788 13.136 120.676 12.864 121.732 12.864C122.26 12.864 122.732 12.912 123.148 13.008C123.564 13.088 123.844 13.144 123.988 13.176L124.348 15.912L123.628 16.032C123.548 15.376 123.324 14.864 122.956 14.496C122.604 14.128 122.156 13.944 121.612 13.944C121.084 13.944 120.644 14.08 120.292 14.352C119.94 14.608 119.764 14.992 119.764 15.504C119.764 15.968 119.924 16.36 120.244 16.68C120.58 17 120.988 17.296 121.468 17.568C121.948 17.84 122.42 18.128 122.884 18.432C123.364 18.736 123.764 19.112 124.084 19.56C124.42 20.008 124.588 20.568 124.588 21.24C124.588 22.12 124.244 22.832 123.556 23.376C122.884 23.92 122.004 24.192 120.916 24.192ZM135.63 24.192C135.15 24.032 134.846 23.792 134.718 23.472C134.59 23.152 134.518 22.856 134.502 22.584C133.99 22.952 133.398 23.312 132.726 23.664C132.07 24.016 131.438 24.192 130.83 24.192C130.542 24.192 130.206 24.144 129.822 24.048C129.454 23.952 129.086 23.736 128.718 23.4C128.43 23.128 128.19 22.776 127.998 22.344C127.822 21.896 127.734 21.312 127.734 20.592V14.76C127.526 14.68 127.278 14.64 126.99 14.64C126.718 14.624 126.47 14.632 126.246 14.664L126.03 14.04L129.198 12.72L129.678 13.056V19.992C129.678 20.392 129.694 20.736 129.726 21.024C129.758 21.296 129.854 21.568 130.014 21.84C130.19 22.128 130.43 22.344 130.734 22.488C131.038 22.632 131.366 22.704 131.718 22.704C132.278 22.704 132.79 22.584 133.254 22.344C133.734 22.088 134.15 21.832 134.502 21.576V14.76C134.294 14.68 134.046 14.64 133.758 14.64C133.486 14.624 133.238 14.632 133.014 14.664L132.798 14.04L135.966 12.72L136.446 13.056V22.416C136.782 22.448 137.11 22.424 137.43 22.344C137.766 22.264 138.054 22.184 138.294 22.104L138.582 22.752L135.63 24.192Z" 
            fill="#000"
            />
            <path d="M14.1724 30C14.1724 30 12.0269 26.9023 9.91073 25.7222C6.4239 23.7777 3.3245 23.7777 3.3245 23.7777L2.54965 22.2222C2.54965 22.2222 9.21708 23.1597 11.8479 26.1111C13.7081 28.198 14.1724 30 14.1724 30Z" fill="#00A48D"/>
            <path d="M16.8844 23C15.2806 25.5757 14.9472 30 14.9472 30C14.9472 30 15.5145 24.5857 17.6592 22.6111C20.5539 19.946 28.1197 20.6666 28.1197 20.6666L28.5071 19.1111C28.5071 19.1111 19.4504 18.8788 16.8844 23Z" fill="#00A48D"/>
            <path d="M14.9472 30L14.1724 30M14.9472 30C14.9472 30 15.2806 25.5757 16.8844 23C19.4504 18.8788 28.5071 19.1111 28.5071 19.1111L28.1197 20.6666C28.1197 20.6666 20.5539 19.946 17.6592 22.6111C15.5145 24.5857 14.9472 30 14.9472 30ZM14.1724 30C14.1724 30 12.0269 26.9023 9.91073 25.7222C6.4239 23.7777 3.3245 23.7777 3.3245 23.7777L2.54965 22.2222C2.54965 22.2222 9.21708 23.1597 11.8479 26.1111C13.7081 28.198 14.1724 30 14.1724 30Z" stroke="#00A48D"/>
            <path d="M14.9473 30C14.9473 30 14.0218 23.929 17.6593 20.2778C21.2967 16.6266 28.8946 17.1667 28.8946 17.1667" stroke="#00A48D"/>
            <path d="M15.0525 28.0836C15.0525 28.0836 14.127 22.0127 17.7645 18.3614C21.402 14.7102 28.9998 15.2504 28.9998 15.2504" stroke="#00A48D"/>
            <path d="M12.5092 12.1477L21.6535 2.96883L22.0692 2.55161M12.5092 12.1477L11.659 14.101L13.605 13.2476M12.5092 12.1477L13.605 13.2476M13.605 13.2476L22.7493 4.06877L23.165 3.65155" stroke="#00A48D" strokeWidth="0.5"/>
            <path d="M22.0675 2.54997L22.3415 2.27499C22.3415 2.27499 22.9062 2.29184 23.1633 2.54997C23.4205 2.8081 23.4373 3.37493 23.4373 3.37493L23.1633 3.64992" stroke="#00A48D" strokeWidth="0.5"/>
            <path d="M17.1378 7.50137L18.2339 8.601" stroke="#00A48D" strokeWidth="0.5"/>
            <path d="M16.0423 8.60158L17.1384 9.7012" stroke="#00A48D" strokeWidth="0.5"/>
            <path d="M14.5599 30C14.5599 30 14.4636 26.4163 11.4605 22.9999C8.05699 19.1281 1 19.4999 1 19.4999V20.6666C1 20.6666 8.09342 20.389 11.0731 23.3888C13.3741 25.7055 14.5599 30 14.5599 30Z" fill="#00A48D" stroke="#00A48D" strokeWidth="0.5"/>
            <path d="M11.0731 14.8333C11.0731 14.8333 5.26176 12.5 3.71206 15.6111C2.16237 18.7222 7.58631 19.5 11.0731 19.8888C15.5843 20.392 15.8964 13.6516 20.3713 12.8888C23.7067 12.3203 29 14.8333 29 14.8333" stroke="#00A48D" strokeWidth="0.5"/>
        </svg>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "ShipporiMincho",
          data: fontData,
          style: 'normal'
        }
      ]
    },
  );
}